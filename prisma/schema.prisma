generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
// AUTHENTICATION (NextAuth.js)
// ============================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ============================================
// CORE ENTITIES
// ============================================

model User {
  id            String    @id @default(cuid())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Auth fields
  email         String    @unique
  emailVerified DateTime?
  password      String?   // For credentials auth
  name          String
  image         String?
  
  // Guardian-specific fields
  role          String    @default("rep") // rep, manager, admin
  phone         String?
  avatarUrl     String?
  isActive      Boolean   @default(true)
  
  // Performance Metrics (aggregated)
  totalDeals        Int      @default(0)
  totalRevenue      Float    @default(0)
  avgDealSize       Float    @default(0)
  closeRate         Float    @default(0)
  monthlyTarget     Float    @default(0)
  
  // Team hierarchy
  managerId     String?
  manager       User?     @relation("TeamHierarchy", fields: [managerId], references: [id])
  teamMembers   User[]    @relation("TeamHierarchy")
  
  // Relationships
  accounts          Account[]
  sessions          Session[]
  customers         Customer[]
  interactions      Interaction[]
  notes             Note[]
  activities        Activity[]
  conversations     Conversation[]
  pushSubscriptions PushSubscription[]
  outreachCampaigns OutreachCampaign[]
}

model Customer {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Basic Info
  firstName     String
  lastName      String
  email         String?
  phone         String?
  altPhone      String?
  
  // Property Info
  address       String
  city          String
  state         String
  zipCode       String
  county        String?
  latitude      Float?
  longitude     Float?
  
  // Property Details (gathered from APIs)
  propertyType      String?   // single-family, multi-family, commercial
  yearBuilt         Int?
  squareFootage     Int?
  lotSize           Float?    // acres
  stories           Int?
  bedrooms          Int?
  bathrooms         Float?
  
  // Roof Details
  roofType          String?   // asphalt shingle, metal, tile, etc.
  roofAge           Int?      // estimated years
  roofSquares       Int?      // roofing squares
  roofPitch         String?   // 4/12, 6/12, etc.
  lastRoofWork      DateTime?
  roofCondition     String?   // excellent, good, fair, poor
  
  // Financial
  propertyValue     Float?
  estimatedJobValue Float?
  
  // Insurance Intel
  insuranceCarrier  String?
  policyNumber      String?
  policyType        String?
  deductible        Float?
  claimHistory      Int       @default(0) // number of prior claims
  
  // Scores & Analytics
  leadScore         Int       @default(0)  // 0-100
  urgencyScore      Int       @default(0)  // 0-100  
  profitPotential   Float     @default(0)  // estimated $
  churnRisk         Int       @default(0)  // 0-100
  engagementScore   Int       @default(0)  // 0-100
  
  // Status
  status            String    @default("lead") // lead, prospect, customer, closed-won, closed-lost
  stage             String    @default("new")  // new, contacted, qualified, proposal, negotiation, closed
  lostReason        String?
  
  // Source tracking
  leadSource        String?   // canvassing, referral, storm, online, etc.
  referredBy        String?
  campaign          String?
  
  // CRM Sync
  crmId             String?   // External CRM ID
  crmSource         String?   // hubspot, salesforce, jobnimbus
  lastCrmSync       DateTime?
  
  // Relationships
  assignedRepId     String?
  assignedRep       User?     @relation(fields: [assignedRepId], references: [id])
  
  interactions      Interaction[]
  weatherEvents     WeatherEvent[]
  documents         Document[]
  intelItems        IntelItem[]
  notes             Note[]
  claims            InsuranceClaim[]
  tasks             Task[]
  photos            Photo[]

  // Performance indexes
  @@index([assignedRepId])
  @@index([leadScore])
  @@index([status, stage])
  @@index([zipCode])
}

// ============================================
// INTELLIGENCE GATHERING
// ============================================

model IntelItem {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  source        String   // api, web-search, manual, crm-sync, weather-api, property-api
  sourceId      String?  // external reference ID
  category      String   // property, insurance, weather, financial, social, news, market
  title         String
  content       String
  confidence    Int      @default(80) // 0-100 confidence score
  actionable    Boolean  @default(false)
  priority      String   @default("medium") // low, medium, high, critical
  
  metadata      String?  // JSON string for flexible data
  expiresAt     DateTime?
  isRead        Boolean  @default(false)
  isDismissed   Boolean  @default(false)
}

model WeatherEvent {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  // Can be linked to customer or standalone for area
  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  // Location
  latitude      Float
  longitude     Float
  zipCode       String?
  county        String?
  city          String?
  state         String?
  
  eventType     String   // hail, wind, tornado, hurricane, flood, thunderstorm
  eventDate     DateTime
  severity      String   // minor, moderate, severe, catastrophic
  
  // Hail specific
  hailSize      Float?   // inches
  hailDuration  Int?     // minutes
  
  // Wind specific
  windSpeed     Float?   // mph
  windGust      Float?   // mph
  windDirection String?
  
  // Damage assessment
  damageReported    Boolean @default(false)
  claimFiled        Boolean @default(false)
  inspectionDone    Boolean @default(false)
  estimatedDamage   Float?
  
  // Data source
  source        String   // NOAA, weather-api, manual, hail-trace
  sourceEventId String?  // External event ID
  rawData       String?  // JSON
  
  // Affected area
  affectedRadius Float?  // miles
  affectedCustomers Int  @default(0)

  // Performance indexes
  @@index([eventDate])
  @@index([zipCode])
}

model InsuranceClaim {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  claimNumber   String?
  carrier       String
  dateOfLoss    DateTime
  claimType     String   // roof, siding, gutters, full-exterior, interior
  
  status        String   @default("pending") // pending, approved, denied, supplement, paid, closed
  
  // Financials
  initialEstimate   Float?
  approvedValue     Float?
  supplementValue   Float?
  totalPaid         Float?
  deductible        Float?
  acv               Float?  // Actual Cash Value
  rcv               Float?  // Replacement Cost Value
  depreciation      Float?
  
  // Adjuster info
  adjusterName      String?
  adjusterPhone     String?
  adjusterEmail     String?
  adjusterCompany   String?
  inspectionDate    DateTime?
  reinspectionDate  DateTime?
  
  // Documents
  scopeOfWork       String?
  photos            String?  // JSON array of URLs
  
  notes         String?
  
  // Supplement tracking
  supplementCount   Int     @default(0)
  lastSupplementDate DateTime?
  
  // Carrier API Integration
  carrierClaimId    String?   // External claim ID from carrier system
  carrierStatus     String?   // Raw status from carrier API
  carrierStatusCode String?   // Carrier-specific status code
  carrierLastSync   DateTime? // Last successful sync with carrier
  carrierMetadata   String?   // JSON - additional carrier-specific data
  isFiledWithCarrier Boolean  @default(false)
  filedWithCarrierAt DateTime?
  
  // Carrier sync tracking
  syncErrors        String?   // JSON array of sync error messages
  lastSyncError     String?
  syncAttempts      Int       @default(0)
  
  @@index([carrierClaimId])
  @@index([carrier, status])
}

// ============================================
// INSURANCE CARRIER CONFIGURATION
// ============================================

model CarrierConfig {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Carrier identification
  carrierCode   String   @unique  // state-farm, allstate, usaa, etc.
  carrierName   String            // Display name
  
  // API Configuration (encrypted in production)
  apiEndpoint   String?
  apiKey        String?
  apiSecret     String?
  clientId      String?
  clientSecret  String?
  
  // OAuth tokens (if applicable)
  accessToken   String?
  refreshToken  String?
  tokenExpiry   DateTime?
  
  // Webhook configuration
  webhookSecret String?
  webhookUrl    String?
  
  // Feature flags
  supportsDirectFiling    Boolean @default(false)
  supportsStatusUpdates   Boolean @default(false)
  supportsDocumentUpload  Boolean @default(false)
  supportsEstimateSync    Boolean @default(false)
  
  // Rate limiting
  rateLimit         Int     @default(100)  // requests per minute
  rateLimitWindow   Int     @default(60)   // seconds
  
  // Status
  isActive      Boolean  @default(true)
  isTestMode    Boolean  @default(true)
  lastHealthCheck DateTime?
  healthStatus  String?   // healthy, degraded, down
  
  // Field mappings (JSON)
  fieldMappings String?   // Maps our fields to carrier fields
  statusMappings String?  // Maps carrier statuses to our statuses
  
  @@index([isActive])
}

model CarrierSyncLog {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  carrierCode   String
  claimId       String?
  
  action        String   // file, update, status-check, document-upload, webhook
  direction     String   // outbound, inbound
  
  requestData   String?  // JSON
  responseData  String?  // JSON
  
  status        String   // success, failed, pending, timeout
  statusCode    Int?     // HTTP status code
  errorMessage  String?
  
  durationMs    Int?     // Request duration in milliseconds
  
  @@index([carrierCode, createdAt])
  @@index([claimId])
}

model PropertyData {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Address (unique identifier)
  address       String
  city          String
  state         String
  zipCode       String
  
  @@unique([address, city, state, zipCode])
  
  // Property details
  parcelNumber  String?
  ownerName     String?
  ownerMailingAddress String?
  
  propertyType  String?
  yearBuilt     Int?
  squareFootage Int?
  lotSize       Float?
  stories       Int?
  bedrooms      Int?
  bathrooms     Float?
  
  // Valuation
  assessedValue     Float?
  marketValue       Float?
  lastSalePrice     Float?
  lastSaleDate      DateTime?
  
  // Roof specific
  roofType      String?
  roofMaterial  String?
  roofYear      Int?
  roofCondition String?
  roofArea      Int?
  
  // Building materials
  exteriorWall  String?
  foundation    String?
  
  // Source tracking
  source        String   // zillow, county-records, attom, corelogic
  sourceId      String?
  rawData       String?  // JSON
  lastFetched   DateTime @default(now())
}

// ============================================
// INTERACTIONS & ACTIVITY
// ============================================

model Interaction {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  userId        String?
  user          User?    @relation(fields: [userId], references: [id])
  
  type          String   // call, email, text, visit, meeting, video-call
  direction     String   @default("outbound") // inbound, outbound
  subject       String?
  content       String?
  outcome       String?  // connected, voicemail, no-answer, scheduled, closed, callback
  sentiment     String?  // positive, neutral, negative
  
  duration      Int?     // seconds
  recordingUrl  String?
  
  nextAction    String?
  nextActionDate DateTime?
  
  // CRM sync
  crmId         String?
}

model Task {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  assignedToId  String
  createdById   String
  
  title         String
  description   String?
  type          String   // call, email, visit, follow-up, inspection, proposal, other
  priority      String   @default("medium") // low, medium, high, urgent
  status        String   @default("pending") // pending, in-progress, completed, cancelled
  
  dueDate       DateTime?
  completedAt   DateTime?
  
  // Reminders
  reminderDate  DateTime?
  reminderSent  Boolean  @default(false)
}

model Note {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  content       String
  isPinned      Boolean  @default(false)
  category      String?  // general, objection, follow-up, insight, competitor
}

model Document {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  name          String
  type          String   // contract, photo, estimate, inspection, insurance, proposal, other
  category      String?  // before, after, damage, signature
  url           String
  thumbnailUrl  String?
  size          Int?     // bytes
  mimeType      String?
  
  metadata      String?  // JSON
}

model Photo {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relationships - flexible: can be linked to customer, claim, or standalone
  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  claimId       String?
  
  uploadedById  String
  
  // Photo details
  filename      String
  originalName  String
  url           String
  thumbnailUrl  String?
  size          Int       // bytes
  mimeType      String
  width         Int?
  height        Int?
  
  // GPS Location (captured at time of photo)
  latitude      Float?
  longitude     Float?
  altitude      Float?    // meters
  accuracy      Float?    // GPS accuracy in meters
  heading       Float?    // compass direction 0-360
  
  // Address (reverse geocoded from GPS)
  capturedAddress   String?
  capturedCity      String?
  capturedState     String?
  capturedZipCode   String?
  
  // Categorization
  category      String    @default("general") // damage, before, after, roof, siding, gutter, interior, signature, adjuster-meeting, other
  tags          String?   // JSON array of tags
  description   String?
  
  // Damage assessment (for damage photos)
  damageType    String?   // hail, wind, water, wear, impact
  damageSeverity String?  // minor, moderate, severe
  
  // Device info
  deviceType    String?   // mobile, tablet, desktop
  deviceModel   String?
  
  // Verification
  isVerified    Boolean   @default(false)
  verifiedAt    DateTime?
  verifiedById  String?
  
  // Indexes
  @@index([customerId])
  @@index([claimId])
  @@index([uploadedById])
  @@index([category])
  @@index([latitude, longitude])
}

model Activity {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  type          String   // login, view, edit, call, email, create, delete
  entityType    String   // customer, lead, claim, document
  entityId      String?
  description   String
  
  metadata      String?  // JSON
  ipAddress     String?
  userAgent     String?
}

// ============================================
// PLAYBOOKS & KNOWLEDGE
// ============================================

model Playbook {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  title         String
  description   String?
  category      String   // objection-handling, closing, discovery, presentation, follow-up
  type          String   // script, checklist, guide, template
  
  content       String   // Markdown content
  
  // Targeting
  stage         String?  // Which pipeline stage this applies to
  scenario      String?  // Specific scenario (e.g., "homeowner hesitant", "adjuster pushback")
  
  // Metadata
  author        String?
  isPublished   Boolean  @default(true)
  usageCount    Int      @default(0)
  rating        Float?
  
  tags          String?  // JSON array
}

// ============================================
// ANALYTICS & AGGREGATES
// ============================================

model DailyMetrics {
  id            String   @id @default(cuid())
  date          DateTime
  userId        String?  // null = company-wide
  
  @@unique([date, userId])
  
  // Lead metrics
  newLeads          Int @default(0)
  qualifiedLeads    Int @default(0)
  contactedLeads    Int @default(0)
  
  // Activity metrics
  callsMade         Int @default(0)
  callsConnected    Int @default(0)
  emailsSent        Int @default(0)
  textsSent         Int @default(0)
  visitsMade        Int @default(0)
  
  // Pipeline metrics
  proposalsSent     Int @default(0)
  proposalValue     Float @default(0)
  
  // Revenue metrics
  dealsClosed       Int @default(0)
  revenueWon        Float @default(0)
  revenueLost       Float @default(0)
  avgDealSize       Float @default(0)
  
  // Weather intel
  weatherAlerts     Int @default(0)
  stormLeads        Int @default(0)
  
  // Conversion metrics
  leadToContactRate Float @default(0)
  contactToQualRate Float @default(0)
  qualToProposalRate Float @default(0)
  proposalToCloseRate Float @default(0)
}

// ============================================
// CRM SYNC TRACKING
// ============================================

model CrmSyncLog {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  
  crmSource     String   // hubspot, salesforce, jobnimbus
  syncType      String   // full, incremental, webhook
  direction     String   // inbound, outbound
  
  entityType    String   // customer, interaction, deal
  entityId      String?
  crmEntityId   String?
  
  status        String   // success, failed, partial
  recordsProcessed Int   @default(0)
  recordsFailed     Int   @default(0)
  
  errorMessage  String?
  rawPayload    String?  // JSON
}

model CrmFieldMapping {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  crmSource     String   // hubspot, salesforce, jobnimbus
  entityType    String   // customer, interaction, deal
  
  localField    String
  crmField      String
  transform     String?  // JSON transformation rules
  
  isActive      Boolean  @default(true)
  
  @@unique([crmSource, entityType, localField])
}

// ============================================
// AI CONVERSATION HISTORY
// ============================================

model Conversation {
  id            String    @id @default(cuid())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Optional customer context
  customerId    String?
  
  // Auto-generated from first message
  title         String?
  
  // Conversation state
  isArchived    Boolean   @default(false)
  
  messages      Message[]
  
  @@index([userId])
  @@index([customerId])
}

model Message {
  id              String       @id @default(cuid())
  createdAt       DateTime     @default(now())
  
  conversationId  String
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  role            String       // user, assistant, system
  content         String
  
  // AI metadata
  model           String?      // Which AI model generated this
  toolCalls       String?      // JSON array of tool calls
  
  @@index([conversationId])
}

// ============================================
// PUSH NOTIFICATIONS
// ============================================

model PushSubscription {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Web Push subscription data
  endpoint  String   @unique
  p256dh    String   // Public key for encryption
  auth      String   // Auth secret
  
  // Device info (optional)
  userAgent String?
  
  @@index([userId])
}

// ============================================
// OUTREACH CAMPAIGNS (Post-Storm Automation)
// ============================================

model OutreachCampaign {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Campaign identity
  name          String
  description   String?
  
  // Trigger configuration
  triggerType   String   // storm, manual, scheduled
  stormTypes    String?  // JSON array: ["hail", "wind", "tornado"]
  minSeverity   String?  // minor, moderate, severe
  
  // Target configuration
  targetZipCodes    String?   // JSON array of ZIP codes (empty = all)
  targetStates      String?   // JSON array of states
  targetStatuses    String?   // JSON array of customer statuses
  targetTags        String?   // JSON array of customer tags
  excludeRecent     Int       @default(30)  // Don't contact if outreach in X days
  
  // Channels
  enableSms         Boolean   @default(true)
  enableEmail       Boolean   @default(true)
  enablePush        Boolean   @default(false)
  
  // Templates
  smsTemplate       String?
  emailSubject      String?
  emailTemplate     String?
  pushTitle         String?
  pushBody          String?
  
  // Timing
  delayMinutes      Int       @default(0)   // Delay after trigger
  sendWindow        String?   // JSON: {"start": "09:00", "end": "20:00"}
  
  // State
  isActive          Boolean   @default(true)
  isArchived        Boolean   @default(false)
  
  // Stats (denormalized for performance)
  totalSent         Int       @default(0)
  totalDelivered    Int       @default(0)
  totalOpened       Int       @default(0)
  totalClicked      Int       @default(0)
  totalResponded    Int       @default(0)
  
  // Creator
  createdById       String
  createdBy         User      @relation(fields: [createdById], references: [id])
  
  // Executions
  executions        CampaignExecution[]
  
  @@index([isActive])
  @@index([triggerType])
}

model CampaignExecution {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  campaignId    String
  campaign      OutreachCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  
  // Trigger info
  triggerType   String    // storm, manual, scheduled
  triggerId     String?   // Storm event ID, schedule ID, etc.
  triggerData   String?   // JSON with storm details, etc.
  
  // Target area
  targetZipCodes    String?   // JSON array
  affectedCustomers Int       @default(0)
  
  // Execution status
  status        String    @default("pending")  // pending, processing, completed, failed, cancelled
  startedAt     DateTime?
  completedAt   DateTime?
  
  // Results
  smsSent       Int       @default(0)
  smsDelivered  Int       @default(0)
  smsFailed     Int       @default(0)
  emailSent     Int       @default(0)
  emailDelivered Int      @default(0)
  emailFailed   Int       @default(0)
  pushSent      Int       @default(0)
  
  // Errors
  errorMessage  String?
  
  // Messages sent in this execution
  messages      OutreachMessage[]
  
  @@index([campaignId])
  @@index([status])
  @@index([createdAt])
}

model OutreachMessage {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  executionId   String
  execution     CampaignExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)
  
  customerId    String
  
  // Message details
  channel       String    // sms, email, push
  recipient     String    // Phone number, email address
  
  // Content (personalized)
  subject       String?   // For email
  body          String
  
  // Status tracking
  status        String    @default("pending")  // pending, sent, delivered, opened, clicked, failed, bounced
  sentAt        DateTime?
  deliveredAt   DateTime?
  openedAt      DateTime?
  clickedAt     DateTime?
  
  // External IDs
  externalId    String?   // Twilio SID, SendGrid ID, etc.
  
  // Error info
  errorCode     String?
  errorMessage  String?
  
  // Response tracking
  hasReplied    Boolean   @default(false)
  replyContent  String?
  replyAt       DateTime?
  
  @@index([executionId])
  @@index([customerId])
  @@index([status])
  @@index([channel])
}

model OutreachTemplate {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  name          String
  description   String?
  category      String   // storm, follow-up, seasonal, promotional
  
  // Channel
  channel       String   // sms, email
  
  // Content
  subject       String?  // For email
  body          String
  
  // Personalization variables used
  variables     String?  // JSON array: ["firstName", "address", "stormType"]
  
  // Metadata
  isDefault     Boolean  @default(false)
  isActive      Boolean  @default(true)
  
  createdById   String
  
  @@index([category])
  @@index([channel])
}
